<?php/** * Created by PhpStorm. * User: ty * Date: 2016/11/17 0017 * Time: 19:52 */class QualityModel{    /**     * 数据库类实例     *     * @var object     */    public $dbh = null;    public $mch = null;    /**     * Constructor     *     * @param   object $dbh     * @return  void     */    public function __construct($dbh, $mch = null)    {        $this->dbh = $dbh;        $this->mch = $mch;    }    /**     * 查询列表     * @author hanshutan     */    public function getList($search,$pages=10,$pagec=1)    {        $filter = array();        if (isset($search['qualityname']) && $search['qualityname'] != '') {            $filter[] = " `qualityname` LIKE '%".$search['qualityname']."%' ";        }        if (isset($search['bar_id']) && $search['bar_id'] != '') {            $filter[] = " sysno='{$search['bar_id']}' ";        }        if (isset($search['bar_status']) && $search['bar_status'] != '') {            $filter[] = " status='{$search['bar_status']}' ";        }        if (isset($search['qualityname2']) && $search['qualityname2'] != '') {            $filter[] = " `qualityname` = '".$search['qualityname2']."' ";        }        $where ='where isdel = 0 ';        if (1 <= count($filter)) {            $where .= " and ". implode(' AND ', $filter);        }        $orderby = "ORDER BY `updated_at` DESC";        $result=array('total'=>0,'list'=>array());        $sql = "SELECT count(`sysno`) FROM ".DB_PREFIX."base_goods_quality {$where}";        $result['totalRow']=$this->dbh->select_one($sql);        $result['totalPage'] = ceil($result['totalRow'] / $pages);        $this->dbh->set_page_num($pagec);        $this->dbh->set_page_rows($pages);        $sql = "SELECT * FROM ".DB_PREFIX."base_goods_quality {$where} {$orderby}";        //error_log($sql, 3, 'sql_print.txt');        $result['list'] = $this->dbh->select_page($sql);        return $result;    }    /**     * Title: 根据编号查询内容     */    public function getQualityById($id){        $sql = "SELECT * FROM ".DB_PREFIX."base_goods_quality WHERE `sysno`=" . $id;        $data = $this->dbh->select_row($sql);        return $data;    }    /**     * Title:新增     */    public function add($data)    {        return $this->dbh->insert(DB_PREFIX.'base_goods_quality', $data);    }    /**     * Title: 编辑     */    public function update($id, $data)    {        return $this->dbh->update(DB_PREFIX.'base_goods_quality', $data, 'sysno=' . intval($id));    }    /*     *删除时查询是否被合同引用     */    public function searchcontractgoodsquality($id){        $sql = "select * from ".DB_PREFIX."doc_contract_goods where goods_quality_sysno = $id AND isdel = 0";        return $this->dbh->select($sql);    }    /*     *删除时查询是否被入库单引用     */    public function searchbookinquality($id){        $sql = "select * from ".DB_PREFIX."doc_booking_in_detail where goods_quality_sysno = $id AND isdel = 0";        return $this->dbh->select($sql);    }    /**     * 获取质量名     */    public function getQualityData($value='')    {        $sql = "select * from ".DB_PREFIX."base_goods_quality where isdel = 0";        return $this->dbh->select($sql);    }}